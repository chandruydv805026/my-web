<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Ratu Fresh ‚Äì ‡§Ü‡§™‡§ï‡§æ ‡§™‡•ç‡§∞‡•ã‡§´‡§º‡§æ‡§á‡§≤</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(to right, #fffbe6, #fff);
      color: #333;
    }

    nav {
      background: linear-gradient(to right, #43cea2, #185a9d);
      padding: 16px 24px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      color: white;
      flex-wrap: wrap;
    }

    .brand-tagline {
      font-size: 22px;
      font-weight: bold;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    nav .icons {
      display: flex;
      gap: 20px;
      font-size: 20px;
      cursor: pointer;
    }

    .hero {
      text-align: center;
      padding: 60px 20px 40px;
    }

    .products {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 1rem;
      padding: 2rem;
    }

    .card {
      background: #fff;
      border-radius: 10px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      padding: 1rem;
      text-align: center;
    }

    .card img {
      width: 100%;
      height: 150px;
      object-fit: cover;
      border-radius: 8px;
    }

    .card select {
      margin: 10px 0;
      padding: 6px;
      font-size: 16px;
    }

    .card button {
      background-color: #f5c842;
      border: none;
      padding: 0.5rem 1rem;
      border-radius: 5px;
      color: white;
      cursor: pointer;
    }

    #profileBox {
      display: none;
      position: absolute;
      top: 70px;
      right: 20px;
      background: #fff;
      border: 1px solid #ccc;
      border-radius: 10px;
      padding: 16px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
      z-index: 999;
      width: 250px;
    }

    #profileBox p {
      margin-bottom: 8px;
      font-size: 15px;
    }

    footer {
      text-align: center;
      padding: 20px;
      font-size: 14px;
      color: #666;
      background-color: #eee;
    }

    @media (max-width: 600px) {
      #profileBox {
        right: 10px;
        top: 60px;
        width: 90%;
      }
    }
  </style>
</head>
<body>

  <nav>
    <div class="brand-tagline">
      ü•¨ Ratu Fresh ‚Äì ‡§§‡§æ‡§ú‡§º‡§ó‡•Ä ‡§π‡§∞ ‡§∏‡•Å‡§¨‡§π
    </div>
    <div class="icons">
      <span onclick="window.location.href='cart.html'">üõí</span>
      <span onclick="toggleProfile()">üë§</span>
    </div>
  </nav>
<div id="profileBox">
  <p><strong>‡§®‡§æ‡§Æ:</strong> <span id="profile-name"></span></p>
  <p><strong>‡§à‡§Æ‡•á‡§≤:</strong> <span id="profile-email"></span></p>
  <p><strong>‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤:</strong> <span id="profile-phone"></span></p>
  <p><strong>‡§™‡§§‡§æ:</strong> <span id="profile-address"></span></p>
<button onclick="logout()" style="margin-top:10px; background:#e74c3c; color:white; border:none; padding:8px 12px; border-radius:6px; cursor:pointer;">üö™ Logout</button>

</div>

  <div class="hero">
    <h2>‡§∏‡§¨‡•ç‡§ú‡§º‡§ø‡§Ø‡§æ‡§Å ‡§Ü‡§™‡§ï‡•á ‡§¶‡§∞‡§µ‡§æ‡§ú‡§º‡•á ‡§§‡§ï</h2>
    <p>‡§π‡§∞ ‡§∏‡•Å‡§¨‡§π ‡§ï‡•Ä ‡§§‡§æ‡§ú‡§º‡§ó‡•Ä ‡§Ö‡§¨ Ratu ‡§Æ‡•á‡§Ç! ‡§ë‡§∞‡•ç‡§°‡§∞ ‡§ï‡§∞‡•á‡§Ç ‡§î‡§∞ ‡§∏‡§¨‡•ç‡§ú‡§º‡§ø‡§Ø‡§æ‡§Å ‡§∏‡•Ä‡§ß‡•á ‡§ò‡§∞ ‡§™‡§∞ ‡§™‡§æ‡§è‡§Ç‡•§</p>
  </div>

  <section class="products">
    <!-- ‡§Ü‡§≤‡•Ç -->
    <div class="card">
      <img src="https://upload.wikimedia.org/wikipedia/commons/a/ab/Patates.jpg" alt="‡§Ü‡§≤‡•Ç" />
      <h3>‡§Ü‡§≤‡•Ç</h3>
      <p>‚Çπ20 / ‡§ï‡§ø‡§≤‡•ã</p>
      <select id="qty-aloo" onchange="updatePrice('aloo', 20)">
        <option value="0.25">250g</option>
        <option value="0.5">500g</option>
        <option value="1" selected>1 ‡§ï‡§ø‡§≤‡•ã</option>
        <option value="2">2 ‡§ï‡§ø‡§≤‡•ã</option>
        <option value="3">3 ‡§ï‡§ø‡§≤‡•ã</option>
        <option value="4">4 ‡§ï‡§ø‡§≤‡•ã</option>
        <option value="5">5 ‡§ï‡§ø‡§≤‡•ã</option>
        <option value="6">6 ‡§ï‡§ø‡§≤‡•ã</option>
        <option value="7">7 ‡§ï‡§ø‡§≤‡•ã</option>
        <option value="8">8 ‡§ï‡§ø‡§≤‡•ã</option>
        <option value="9">9 ‡§ï‡§ø‡§≤‡•ã</option>
        <option value="10">10 ‡§ï‡§ø‡§≤‡•ã</option>
      </select>
      <p id="price-aloo">‡§ï‡•Å‡§≤ ‡§ï‡•Ä‡§Æ‡§§: ‚Çπ20</p>
      <button onclick="addToCart('‡§Ü‡§≤‡•Ç', 20, 'qty-aloo')">Add to Cart</button>
    </div>

    <!-- ‡§ü‡§Æ‡§æ‡§ü‡§∞ -->
    <div class="card">
      <img src="https://upload.wikimedia.org/wikipedia/commons/8/89/Tomato_je.jpg" alt="‡§ü‡§Æ‡§æ‡§ü‡§∞" />
      <h3>‡§ü‡§Æ‡§æ‡§ü‡§∞</h3>
      <p>‚Çπ30 / ‡§ï‡§ø‡§≤‡•ã</p>
      <select id="qty-tomato" onchange="updatePrice('tomato', 30)">
        <option value="0.25">250g</option>
        <option value="0.5">500g</option>
        <option value="1" selected>1 ‡§ï‡§ø‡§≤‡•ã</option>
        <option value="2">2 ‡§ï‡§ø‡§≤‡•ã</option>
        <option value="3">3 ‡§ï‡§ø‡§≤‡•ã</option>
        <option value="4">4 ‡§ï‡§ø‡§≤‡•ã</option>
        <option value="5">5 ‡§ï‡§ø‡§≤‡•ã</option>
        <option value="6">6 ‡§ï‡§ø‡§≤‡•ã</option>
        <option value="7">7 ‡§ï‡§ø‡§≤‡•ã</option>
        <option value="8">8 ‡§ï‡§ø‡§≤‡•ã</option>
        <option value="9">9 ‡§ï‡§ø‡§≤‡•ã</option>
        <option value="10">10 ‡§ï‡§ø‡§≤‡•ã</option>
      </select>
      <p id="price-tomato">‡§ï‡•Å‡§≤ ‡§ï‡•Ä‡§Æ‡§§: ‚Çπ30</p>
      <button onclick="addToCart('‡§ü‡§Æ‡§æ‡§ü‡§∞', 30, 'qty-tomato')">Add to Cart</button>
    </div>

    <!-- ‡§™‡•ç‡§Ø‡§æ‡§ú‡§º -->
    <div class="card">
      <img src="onion.png" alt="‡§™‡•ç‡§Ø‡§æ‡§ú‡§º" />
      <h3>‡§™‡•ç‡§Ø‡§æ‡§ú‡§º</h3>
      <p>‚Çπ25 / ‡§ï‡§ø‡§≤‡•ã</p>
      <select id="qty-onion" onchange="updatePrice('onion', 25)">
        <option value="0.25">250g</option>
        <option value="0.5">500g</option>
        <option value="1" selected>1 ‡§ï‡§ø‡§≤‡•ã</option>
        <option value="2">2 ‡§ï‡§ø‡§≤‡•ã</option>
        <option value="3">3 ‡§ï‡§ø‡§≤‡•ã</option>
        <option value="4">4 ‡§ï‡§ø‡§≤‡•ã</option>
        <option value="5">5 ‡§ï‡§ø‡§≤‡•ã</option>
        <option value="6">6 ‡§ï‡§ø‡§≤‡•ã</option>
        <option value="7">7 ‡§ï‡§ø‡§≤‡•ã</option>
        <option value="8">8 ‡§ï‡§ø‡§≤‡•ã</option>
        <option value="9">9 ‡§ï‡§ø‡§≤‡•ã</option>
        <option value="10">10 ‡§ï‡§ø‡§≤‡•ã</option>
      </select>
      <p id="price-onion">‡§ï‡•Å‡§≤ ‡§ï‡•Ä‡§Æ‡§§: ‚Çπ25</p>
      <button onclick="addToCart('‡§™‡•ç‡§Ø‡§æ‡§ú‡§º', 25, 'qty-onion')">Add to Cart</button>
    </div>
  </section>

  <footer>
    ¬© 2025 Chandan Yadav, Ratu Jharkhand. All rights reserved.
  </footer>
<script>
  let cart = [];

  function updatePrice(id, rate) {
    const qty = parseFloat(document.getElementById("qty-" + id).value);
    const total = Math.round(rate * qty);
    document.getElementById("price-" + id).textContent = `‡§ï‡•Å‡§≤ ‡§ï‡•Ä‡§Æ‡§§: ‚Çπ${total}`;
  }

  function addToCart(name, rate, selectId) {
    const user = JSON.parse(localStorage.getItem("userData"));
    if (!user || !user._id) {
      alert("‡§ï‡•É‡§™‡§Ø‡§æ ‡§™‡§π‡§≤‡•á ‡§≤‡•â‡§ó‡§ø‡§® ‡§ï‡§∞‡•á‡§Ç");
      window.location.href = "login.html";
      return;
    }

    const qty = parseFloat(document.getElementById(selectId).value);
    const total = Math.round(rate * qty);
    const label = qty < 1 ? `${qty * 1000} ‡§ó‡•ç‡§∞‡§æ‡§Æ` : `${qty} ‡§ï‡§ø‡§≤‡•ã`;

    fetch("http://localhost:4000/cart/add", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        userId: user._id,
        productId: name,
        name: name,
        quantity: qty,
        price: rate
      })
    })
    .then(res => res.json())
    .then(data => {
      if (data.cart) {
        cart = data.cart.items;
        renderCart(cart, data.cart.totalPrice);
        alert(`‚úÖ ${label} ${name} ‡§ú‡•ã‡§°‡§º‡§æ ‡§ó‡§Ø‡§æ‡•§ ‡§ï‡•Å‡§≤ ‚Çπ${total}`);
      } else {
        console.error("Backend error:", data);
        alert("‚ùå ‡§ï‡•Å‡§õ ‡§ó‡§°‡§º‡§¨‡§°‡§º ‡§π‡•ã ‡§ó‡§à: " + (data.error || "Unknown error"));
      }
    })
    .catch(err => {
      console.error("Cart error:", err);
      alert("‚ùå Cart ‡§ú‡•ã‡§°‡§º‡§®‡•á ‡§Æ‡•á‡§Ç ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ ‡§π‡•Å‡§à");
    });
  }

  function renderCart(items, total) {
    const cartList = document.getElementById("cartItems");
    const cartTotal = document.getElementById("cartTotal");

    // ‚úÖ ‡§Ö‡§ó‡§∞ cart summary section ‡§Æ‡•å‡§ú‡•Ç‡§¶ ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à ‡§§‡•ã skip ‡§ï‡§∞‡•ã
    if (!cartList || !cartTotal) return;

    cartList.innerHTML = "";
    items.forEach(item => {
      const li = document.createElement("li");
      li.textContent = `${item.name} x ${item.quantity} = ‚Çπ${item.quantity * item.price}`;
      cartList.appendChild(li);
    });
    cartTotal.textContent = total;
  }

  function toggleProfile() {
    const box = document.getElementById("profileBox");
    box.style.display = box.style.display === "block" ? "none" : "block";
  }

  function logout() {
    localStorage.removeItem("userData");
    alert("‡§Ü‡§™ ‡§≤‡•â‡§ó‡§Ü‡§â‡§ü ‡§π‡•ã ‡§ó‡§è ‡§π‡•à‡§Ç");
    window.location.href = "main.html";
  }

  window.onload = function () {
    updatePrice('aloo', 20);
    updatePrice('tomato', 30);
    updatePrice('onion', 25);

    const user = JSON.parse(localStorage.getItem("userData"));
    if (user && user._id) {
      document.getElementById("profile-name").textContent = user.name || "‡§®‡§æ‡§Æ ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ";
      document.getElementById("profile-email").textContent = user.email || "‡§à‡§Æ‡•á‡§≤ ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ";
      document.getElementById("profile-phone").textContent = user.phone || "‡§´‡•ã‡§® ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ";
      document.getElementById("profile-address").textContent = user.address || "‡§™‡§§‡§æ ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ";

      fetch(`http://localhost:4000/cart/${user._id}`)
        .then(res => res.json())
        .then(data => {
          cart = data.items || [];
          renderCart(cart, data.totalPrice || 0);
        })
        .catch(err => {
          console.error("Cart fetch error:", err);
        });
    } else {
      alert("User data ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ, ‡§ï‡•É‡§™‡§Ø‡§æ login ‡§ï‡§∞‡•á‡§Ç");
      window.location.href = "login.html";
    }
  };
</script>

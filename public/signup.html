<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Signup ‚Äì Ratu Fresh</title>
  <style>
    * {
      box-sizing: border-box;
      font-family: 'Segoe UI', sans-serif;
    }

    body {
      margin: 0;
      background: linear-gradient(to right, #e0eafc, #cfdef3);
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      padding: 20px;
      color: #333;
    }

    .signup-container {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(14px);
      border-radius: 16px;
      padding: 40px 30px;
      box-shadow: 0 8px 30px rgba(0, 0, 0, 0.15);
      width: 100%;
      max-width: 450px;
      animation: slideIn 0.5s ease-out;
      position: relative;
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .header {
      text-align: center;
      margin-bottom: 30px;
    }

    .header h2 {
      font-size: 28px;
      color: #185a9d;
      margin-bottom: 8px;
      font-weight: 700;
    }

    .header p {
      font-size: 13px;
      color: #666;
    }

    form {
      display: flex;
      flex-direction: column;
      gap: 18px;
    }

    .form-group {
      position: relative;
      display: flex;
      flex-direction: column;
    }

    .form-group input {
      width: 100%;
      padding: 12px 14px;
      border: 2px solid #e0e0e0;
      border-radius: 10px;
      font-size: 14px;
      background: rgba(255, 255, 255, 0.8);
      color: #333;
      outline: none;
      transition: all 0.3s ease;
    }

    .form-group input:focus {
      border-color: #185a9d;
      background: #fff;
      box-shadow: 0 0 8px rgba(24, 90, 157, 0.1);
    }

    .form-group input.error {
      border-color: #ff6b6b;
      background: rgba(255, 107, 107, 0.05);
    }

    .form-group label {
      font-size: 13px;
      color: #185a9d;
      font-weight: 500;
      margin-bottom: 6px;
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .label-required {
      color: #ff4d4d;
    }

    .error-text {
      font-size: 12px;
      color: #ff6b6b;
      margin-top: 4px;
      display: none;
    }

    .error-text.show {
      display: block;
    }

    .form-row {
      display: grid;
      grid-template-columns: 1fr auto;
      gap: 8px;
      align-items: flex-end;
    }

    .map-btn {
      padding: 12px 14px;
      background: linear-gradient(to right, #43cea2, #185a9d);
      color: #fff;
      border: none;
      border-radius: 10px;
      font-size: 18px;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 44px;
      width: 44px;
      font-weight: 600;
    }

    .map-btn:hover {
      transform: scale(1.05);
      box-shadow: 0 4px 12px rgba(24, 90, 157, 0.3);
    }

    .map-btn:active {
      transform: scale(0.98);
    }

    .hint-text {
      font-size: 12px;
      margin-top: 6px;
      padding: 8px 10px;
      border-radius: 6px;
      background: rgba(24, 90, 157, 0.05);
      border-left: 3px solid #185a9d;
      color: #185a9d;
    }

    .hint-text.landmark {
      border-left-color: #43cea2;
      color: #43cea2;
    }

    button[type="submit"] {
      padding: 14px;
      background: linear-gradient(to right, #43cea2, #185a9d);
      color: #fff;
      border: none;
      border-radius: 10px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      position: relative;
      transition: all 0.3s ease;
      margin-top: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    button[type="submit"]:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(24, 90, 157, 0.3);
    }

    button[type="submit"]:active:not(:disabled) {
      transform: translateY(0);
    }

    button[type="submit"]:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    .spinner {
      width: 16px;
      height: 16px;
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-top: 2px solid #fff;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
      display: none;
    }

    button[type="submit"].loading .spinner {
      display: inline-block;
    }

    button[type="submit"].loading {
      opacity: 0.8;
    }

    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }

    .popup {
      position: fixed;
      bottom: -100px;
      left: 50%;
      transform: translateX(-50%);
      background: #43cea2;
      color: #fff;
      padding: 16px 24px;
      border-radius: 10px;
      font-size: 14px;
      font-weight: 500;
      box-shadow: 0 4px 12px rgba(67, 206, 162, 0.3);
      opacity: 0;
      transition: all 0.3s ease;
      z-index: 1000;
      text-align: center;
      max-width: 90%;
      word-wrap: break-word;
      pointer-events: none;
    }

    .popup.show {
      bottom: 30px;
      opacity: 1;
    }

    .popup.error {
      background: #ff6b6b;
      box-shadow: 0 4px 12px rgba(255, 107, 107, 0.3);
    }

    .popup.success {
      background: #43cea2;
      box-shadow: 0 4px 12px rgba(67, 206, 162, 0.3);
    }

    .login-link {
      text-align: center;
      margin-top: 20px;
      font-size: 13px;
      color: #666;
    }

    .login-link a {
      color: #185a9d;
      text-decoration: none;
      font-weight: 600;
      cursor: pointer;
    }

    .login-link a:hover {
      text-decoration: underline;
    }

    .form-divider {
      text-align: center;
      font-size: 12px;
      color: #999;
      margin: 5px 0;
    }

    @media (max-width: 480px) {
      .signup-container {
        padding: 25px 18px;
      }

      .header h2 {
        font-size: 22px;
      }

      form {
        gap: 14px;
      }

      .popup {
        font-size: 13px;
        padding: 12px 18px;
      }

      .map-btn {
        width: 40px;
        height: 40px;
      }
    }
  </style>
</head>
<body>
  <div class="signup-container">
    <div class="header">
      <h2>üìù ‡§Ö‡§™‡§®‡§æ ‡§ñ‡§æ‡§§‡§æ ‡§¨‡§®‡§æ‡§è‡§Ç</h2>
      <p>Ratu Fresh ‡§Æ‡•á‡§Ç ‡§ú‡•Å‡§°‡§º‡•á‡§Ç - ‡§§‡§æ‡§ú‡•Ä ‡§∏‡§¨‡•ç‡§ú‡§ø‡§Ø‡§æ‡§Ç, ‡§§‡•á‡§ú‡§º ‡§°‡§ø‡§≤‡•Ä‡§µ‡§∞‡•Ä!</p>
    </div>

    <form id="signupForm" novalidate>
      <!-- Name -->
      <div class="form-group">
        <label>
          ‡§™‡•Ç‡§∞‡§æ ‡§®‡§æ‡§Æ
          <span class="label-required">*</span>
        </label>
        <input
          type="text"
          name="name"
          id="nameInput"
          placeholder="‡§Ö‡§™‡§®‡§æ ‡§®‡§æ‡§Æ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç"
          required
        />
        <div class="error-text" id="nameError"></div>
      </div>

      <!-- Phone -->
      <div class="form-group">
        <label>
          ‡§´‡•ã‡§® ‡§®‡§Ç‡§¨‡§∞
          <span class="label-required">*</span>
        </label>
        <input
          type="tel"
          name="phone"
          id="phoneInput"
          placeholder="10-‡§Ö‡§Ç‡§ï‡•Ä‡§Ø ‡§´‡•ã‡§® ‡§®‡§Ç‡§¨‡§∞"
          maxlength="10"
          inputmode="numeric"
          required
        />
        <div class="error-text" id="phoneError"></div>
      </div>

      <!-- Email -->
      <div class="form-group">
        <label>
          ‡§à‡§Æ‡•á‡§≤
          <span class="label-required">*</span>
        </label>
        <input
          type="email"
          name="email"
          id="emailInput"
          placeholder="‡§Ü‡§™‡§ï‡§æ ‡§à‡§Æ‡•á‡§≤"
          required
        />
        <div class="error-text" id="emailError"></div>
      </div>

      <!-- Address with Map -->
      <div class="form-group">
        <label>
          ‡§™‡•Ç‡§∞‡§æ ‡§™‡§§‡§æ
          <span class="label-required">*</span>
        </label>
        <div class="form-row">
          <input
            type="text"
            name="address"
            id="addressInput"
            placeholder="‡§™‡•Ç‡§∞‡§æ ‡§™‡§§‡§æ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç"
            required
          />
          <button type="button" class="map-btn" id="locBtn" title="GPS ‡§∏‡•á ‡§™‡§§‡§æ ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§ ‡§ï‡§∞‡•á‡§Ç">
            üìç
          </button>
        </div>
        <div class="error-text" id="addressError"></div>
      </div>

      <!-- Pincode -->
      <div class="form-group">
        <label>
          ‡§™‡§ø‡§®‡§ï‡•ã‡§°
          <span class="label-required">*</span>
        </label>
        <input
          type="text"
          name="pincode"
          id="pincodeInput"
          placeholder="6-‡§Ö‡§Ç‡§ï‡•Ä‡§Ø ‡§™‡§ø‡§®‡§ï‡•ã‡§°"
          maxlength="6"
          inputmode="numeric"
          required
        />
        <div class="error-text" id="pincodeError"></div>
      </div>

      <!-- Area / Landmark -->
      <div class="form-group">
        <label>
          ‡§®‡§ú‡§º‡§¶‡•Ä‡§ï‡•Ä ‡§á‡§≤‡§æ‡§ï‡§æ / ‡§≤‡•à‡§Ç‡§°‡§Æ‡§æ‡§∞‡•ç‡§ï
          <span class="label-required">*</span>
        </label>
        <input
          type="text"
          name="area"
          id="areaInput"
          placeholder="‡§ú‡•à‡§∏‡•á: ‡§¨‡§æ‡§ú‡§æ‡§∞, ‡§™‡§æ‡§∞‡•ç‡§ï, ‡§Æ‡§Ç‡§¶‡§ø‡§∞"
          required
        />
        <div class="hint-text landmark" id="landmarkHint">
          üìç ‡§®‡§ú‡§º‡§¶‡•Ä‡§ï‡•Ä ‡§™‡•ç‡§∞‡§∏‡§ø‡§¶‡•ç‡§ß ‡§ú‡§ó‡§π ‡§Ø‡§π‡§æ‡§Å ‡§¶‡§ø‡§ñ‡§æ‡§à ‡§¶‡•á‡§ó‡•Ä
        </div>
        <div class="error-text" id="areaError"></div>
      </div>

      <!-- Village / Area -->
      <div class="form-group">
        <label>
          ‡§ó‡§æ‡§Å‡§µ / ‡§Æ‡•ã‡§π‡§≤‡•ç‡§≤‡§æ
          <span class="label-required">*</span>
        </label>
        <input
          type="text"
          name="village"
          id="villageInput"
          placeholder="‡§ó‡§æ‡§Å‡§µ ‡§Ø‡§æ ‡§Æ‡•ã‡§π‡§≤‡•ç‡§≤‡•á ‡§ï‡§æ ‡§®‡§æ‡§Æ"
          required
        />
        <div class="hint-text" id="villageHint">
          üè° ‡§Ø‡§π‡§æ‡§Å ‡§ó‡§æ‡§Å‡§µ/‡§Æ‡•ã‡§π‡§≤‡•ç‡§≤‡•á ‡§ï‡§æ ‡§®‡§æ‡§Æ ‡§¶‡§ø‡§ñ‡•á‡§ó‡§æ
        </div>
        <div class="error-text" id="villageError"></div>
      </div>

      <button type="submit" id="signupBtn">
        <span id="buttonText">‡§∏‡§æ‡§á‡§® ‡§Ö‡§™ ‡§ï‡§∞‡•á‡§Ç</span>
        <span class="spinner" id="spinner"></span>
      </button>
    </form>

    <div class="form-divider">‡§™‡§π‡§≤‡•á ‡§∏‡•á ‡§ñ‡§æ‡§§‡§æ ‡§π‡•à?</div>
    <div class="login-link">
      <a onclick="goToLogin()">‡§≤‡•â‡§ó‡§ø‡§® ‡§ï‡§∞‡•á‡§Ç</a>
    </div>
  </div>

  <div id="popup" class="popup"></div>

  <script>
    // ============= CONSTANTS =============
    const API_BASE_URL = 'https://my-web-xrr5.onrender.com';
    const REQUEST_TIMEOUT = 10000;

    // ============= DOM ELEMENTS =============
    const form = document.getElementById('signupForm');
    const nameInput = document.getElementById('nameInput');
    const phoneInput = document.getElementById('phoneInput');
    const emailInput = document.getElementById('emailInput');
    const addressInput = document.getElementById('addressInput');
    const pincodeInput = document.getElementById('pincodeInput');
    const areaInput = document.getElementById('areaInput');
    const villageInput = document.getElementById('villageInput');
    const locBtn = document.getElementById('locBtn');
    const signupBtn = document.getElementById('signupBtn');
    const popup = document.getElementById('popup');
    const landmarkHint = document.getElementById('landmarkHint');
    const villageHint = document.getElementById('villageHint');

    // Error elements
    const errorElements = {
      name: document.getElementById('nameError'),
      phone: document.getElementById('phoneError'),
      email: document.getElementById('emailError'),
      address: document.getElementById('addressError'),
      pincode: document.getElementById('pincodeError'),
      area: document.getElementById('areaError'),
      village: document.getElementById('villageError')
    };

    // Hidden fields for latitude and longitude
    const latInput = document.createElement('input');
    const lngInput = document.createElement('input');
    latInput.type = lngInput.type = 'hidden';
    latInput.name = 'latitude';
    lngInput.name = 'longitude';
    form.appendChild(latInput);
    form.appendChild(lngInput);

    // ============= UTILITY FUNCTIONS =============
    function showPopup(message, isError = false) {
      popup.textContent = message;
      popup.className = isError ? 'popup show error' : 'popup show success';
      
      setTimeout(() => {
        popup.classList.remove('show');
      }, 3500);
    }

    function showError(fieldName, message) {
      const input = document.getElementById(`${fieldName}Input`);
      const errorEl = errorElements[fieldName];
      
      if (input) input.classList.add('error');
      if (errorEl) {
        errorEl.textContent = message;
        errorEl.classList.add('show');
      }
    }

    function hideError(fieldName) {
      const input = document.getElementById(`${fieldName}Input`);
      const errorEl = errorElements[fieldName];
      
      if (input) input.classList.remove('error');
      if (errorEl) {
        errorEl.textContent = '';
        errorEl.classList.remove('show');
      }
    }

    function formatArea(addr = {}) {
      return (
        addr.suburb ||
        addr.residential ||
        addr.quarter ||
        addr.village ||
        addr.town ||
        addr.city ||
        ''
      );
    }

    function getVillageName(addr = {}) {
      return (
        addr.village ||
        addr.hamlet ||
        addr.locality ||
        addr.suburb ||
        addr.city ||
        ''
      );
    }

    function fillAddressFromGeo(payload, data) {
      try {
        const addr = data.components || {};
        
        addressInput.value = data.displayName || `${payload.lat.toFixed(5)}, ${payload.lng.toFixed(5)}`;
        
        if (addr.postcode) {
          pincodeInput.value = addr.postcode;
          hideError('pincode');
        }
        
        const areaValue = formatArea(addr) || data.displayName || '‡§≤‡•ã‡§ï‡•á‡§∂‡§® ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§π‡•Ä‡§Ç';
        areaInput.value = areaValue;
        landmarkHint.textContent = `‚≠ê ${areaValue}`;
        hideError('area');
        
        const villageName = getVillageName(addr) || '‡§≤‡•ã‡§ï‡•á‡§∂‡§® ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§π‡•Ä‡§Ç';
        villageInput.value = villageName;
        villageHint.textContent = `üè° ${villageName}`;
        hideError('village');
        
        latInput.value = payload.lat;
        lngInput.value = payload.lng;
        
        console.log("‚úÖ Address filled from GPS");
        showPopup('‚úÖ ‡§™‡§§‡§æ, ‡§™‡§ø‡§®‡§ï‡•ã‡§° ‡§î‡§∞ ‡§á‡§≤‡§æ‡§ï‡§æ ‡§ë‡§ü‡•ã-‡§≠‡§∞‡§æ ‡§ó‡§Ø‡§æ');
      } catch (err) {
        console.error("‚ùå Error filling address:", err);
        showPopup('‚ùå ‡§™‡§§‡§æ ‡§≠‡§∞‡§®‡•á ‡§Æ‡•á‡§Ç ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø', true);
      }
    }

    // ============= INPUT VALIDATION =============
    const validationRules = {
      name: (value) => {
        if (!value) return '‡§®‡§æ‡§Æ ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï ‡§π‡•à';
        if (value.length < 2) return '‡§®‡§æ‡§Æ ‡§ï‡§Æ ‡§∏‡•á ‡§ï‡§Æ 2 ‡§Ö‡§ï‡•ç‡§∑‡§∞ ‡§ï‡§æ ‡§π‡•ã‡§®‡§æ ‡§ö‡§æ‡§π‡§ø‡§è';
        if (!/^[a-zA-Z\s]+$/.test(value)) return '‡§ï‡•á‡§µ‡§≤ ‡§Ö‡§ï‡•ç‡§∑‡§∞ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç';
        return null;
      },
      phone: (value) => {
        if (!value) return '‡§´‡•ã‡§® ‡§®‡§Ç‡§¨‡§∞ ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï ‡§π‡•à';
        if (!/^[6-9]\d{9}$/.test(value)) return '‡§∏‡§π‡•Ä 10-‡§Ö‡§Ç‡§ï‡•Ä‡§Ø ‡§´‡•ã‡§® ‡§®‡§Ç‡§¨‡§∞ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç';
        return null;
      },
      email: (value) => {
        if (!value) return '‡§à‡§Æ‡•á‡§≤ ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï ‡§π‡•à';
        if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(value)) return '‡§∏‡§π‡•Ä ‡§à‡§Æ‡•á‡§≤ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç';
        return null;
      },
      address: (value) => {
        if (!value) return '‡§™‡•Ç‡§∞‡§æ ‡§™‡§§‡§æ ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï ‡§π‡•à';
        if (value.length < 10) return '‡§™‡§§‡§æ ‡§ï‡§Æ ‡§∏‡•á ‡§ï‡§Æ 10 ‡§Ö‡§ï‡•ç‡§∑‡§∞ ‡§ï‡§æ ‡§π‡•ã‡§®‡§æ ‡§ö‡§æ‡§π‡§ø‡§è';
        return null;
      },
      pincode: (value) => {
        if (!value) return '‡§™‡§ø‡§®‡§ï‡•ã‡§° ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï ‡§π‡•à';
        if (!/^\d{6}$/.test(value)) return '6-‡§Ö‡§Ç‡§ï‡•Ä‡§Ø ‡§™‡§ø‡§®‡§ï‡•ã‡§° ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç';
        return null;
      },
      area: (value) => {
        if (!value) return '‡§á‡§≤‡§æ‡§ï‡§æ / ‡§≤‡•à‡§Ç‡§°‡§Æ‡§æ‡§∞‡•ç‡§ï ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï ‡§π‡•à';
        return null;
      },
      village: (value) => {
        if (!value) return '‡§ó‡§æ‡§Å‡§µ / ‡§Æ‡•ã‡§π‡§≤‡•ç‡§≤‡§æ ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï ‡§π‡•à';
        return null;
      }
    };

    Object.keys(validationRules).forEach(fieldName => {
      const input = document.getElementById(`${fieldName}Input`);
      
      input.addEventListener('blur', () => {
        const error = validationRules[fieldName](input.value.trim());
        if (error) {
          showError(fieldName, error);
        } else {
          hideError(fieldName);
        }
      });

      input.addEventListener('input', () => {
        hideError(fieldName);
      });
    });

    // Phone input - allow only digits
    phoneInput.addEventListener('input', (e) => {
      e.target.value = e.target.value.replace(/\D/g, '').slice(0, 10);
    });

    // Pincode input - allow only digits
    pincodeInput.addEventListener('input', (e) => {
      e.target.value = e.target.value.replace(/\D/g, '').slice(0, 6);
    });

    // ============= GEOLOCATION =============
    locBtn.addEventListener('click', (e) => {
      e.preventDefault();

      if (!navigator.geolocation) {
        showPopup('‚ùå ‡§Ü‡§™‡§ï‡•á ‡§°‡§ø‡§µ‡§æ‡§á‡§∏ ‡§Æ‡•á‡§Ç ‡§≤‡•ã‡§ï‡•á‡§∂‡§® ‡§∏‡§™‡•ã‡§∞‡•ç‡§ü ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à', true);
        return;
      }

      locBtn.disabled = true;
      locBtn.textContent = '‚è≥';

      navigator.geolocation.getCurrentPosition(
        async ({ coords }) => {
          const payload = {
            lat: coords.latitude,
            lng: coords.longitude
          };

          console.log("üìç Got coordinates:", payload);

          try {
            const controller = new AbortController();
            const timeoutId = setTimeout(() => controller.abort(), REQUEST_TIMEOUT);

            const res = await fetch(`${API_BASE_URL}/reverse-geocode`, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify(payload),
              signal: controller.signal
            });

            clearTimeout(timeoutId);

            const data = await res.json();

            if (res.ok && data.displayName) {
              fillAddressFromGeo(payload, data);
              
              // Open Google Maps
              window.open(
                `https://www.google.com/maps?q=${payload.lat},${payload.lng}`,
                '_blank'
              );
            } else {
              addressInput.value = `${payload.lat.toFixed(5)}, ${payload.lng.toFixed(5)}`;
              showPopup('‚ö†Ô∏è ‡§∏‡§ü‡•Ä‡§ï ‡§™‡§§‡§æ ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ, ‡§ï‡•â‡§∞‡•ç‡§°‡§ø‡§®‡•á‡§ü‡•ç‡§∏ ‡§≠‡§∞‡•á ‡§ó‡§è', true);
            }
          } catch (err) {
            console.error("‚ùå Geolocation error:", err);
            addressInput.value = `${payload.lat.toFixed(5)}, ${payload.lng.toFixed(5)}`;
            showPopup('‚ùå ‡§∏‡§∞‡•ç‡§µ‡§∞ ‡§∏‡•á ‡§ï‡§®‡•á‡§ï‡•ç‡§ü ‡§®‡§π‡•Ä‡§Ç ‡§π‡•ã ‡§™‡§æ‡§Ø‡§æ', true);
          } finally {
            locBtn.disabled = false;
            locBtn.textContent = 'üìç';
          }
        },
        (error) => {
          console.error("‚ùå Geolocation error:", error);
          let message = '‚ùå ‡§≤‡•ã‡§ï‡•á‡§∂‡§® ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤ ‡§™‡§æ‡§à';
          
          if (error.code === error.PERMISSION_DENIED) {
            message = '‚ùå ‡§ï‡•É‡§™‡§Ø‡§æ ‡§≤‡•ã‡§ï‡•á‡§∂‡§® ‡§™‡§∞‡§Æ‡§ø‡§∂‡§® ‡§¶‡•á‡§Ç';
          } else if (error.code === error.POSITION_UNAVAILABLE) {
            message = '‚ùå ‡§≤‡•ã‡§ï‡•á‡§∂‡§® ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à';
          } else if (error.code === error.TIMEOUT) {
            message = '‚ùå ‡§≤‡•ã‡§ï‡•á‡§∂‡§® ‡§∏‡§Æ‡§Ø ‡§∏‡•Ä‡§Æ‡§æ ‡§∏‡§Æ‡§æ‡§™‡•ç‡§§';
          }
          
          showPopup(message, true);
          locBtn.disabled = false;
          locBtn.textContent = 'üìç';
        },
        {
          enableHighAccuracy: true,
          timeout: 5000,
          maximumAge: 0
        }
      );
    });

    // ============= FORM SUBMISSION =============
    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      // Validate all fields
      let hasError = false;
      Object.keys(validationRules).forEach(fieldName => {
        const input = document.getElementById(`${fieldName}Input`);
        const error = validationRules[fieldName](input.value.trim());
        
        if (error) {
          showError(fieldName, error);
          hasError = true;
        } else {
          hideError(fieldName);
        }
      });

      if (hasError) {
        showPopup('‚ùå ‡§ï‡•É‡§™‡§Ø‡§æ ‡§∏‡§≠‡•Ä ‡§´‡•Ä‡§≤‡•ç‡§° ‡§∏‡§π‡•Ä ‡§∏‡•á ‡§≠‡§∞‡•á‡§Ç', true);
        return;
      }

      signupBtn.classList.add('loading');
      signupBtn.disabled = true;

      try {
        const body = {
          name: nameInput.value.trim(),
          phone: phoneInput.value.trim(),
          email: emailInput.value.trim(),
          address: addressInput.value.trim(),
          pincode: pincodeInput.value.trim(),
          area: areaInput.value.trim()
        };

        console.log("üì§ Submitting signup:", body);

        const controller = new AbortController();
        const timeoutId = setTimeout(() => controller.abort(), REQUEST_TIMEOUT);

        const res = await fetch(`${API_BASE_URL}/signup`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(body),
          signal: controller.signal
        });

        clearTimeout(timeoutId);

        const data = await res.json();

        if (!res.ok) {
          throw new Error(data.error || 'Signup failed');
        }

        console.log("‚úÖ Signup successful:", data);
        
        showPopup('‚úÖ Signup ‡§∏‡§´‡§≤! ‡§Ö‡§¨ ‡§≤‡•â‡§ó‡§ø‡§® ‡§ï‡§∞‡•á‡§Ç');
        
        setTimeout(() => {
          window.location.href = 'login.html';
        }, 1500);

        form.reset();
      } catch (err) {
        console.error("‚ùå Signup error:", err);
        
        let errorMessage = err.message || 'Signup failed';
        if (err.name === 'AbortError') {
          errorMessage = '‚ùå Request timeout - ‡§ï‡§®‡•á‡§ï‡•ç‡§∂‡§® ‡§ú‡§æ‡§Ç‡§ö‡•á‡§Ç';
        } else if (err instanceof TypeError) {
          errorMessage = '‚ùå ‡§®‡•á‡§ü‡§µ‡§∞‡•ç‡§ï ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø';
        }
        
        showPopup(errorMessage, true);
      } finally {
        signupBtn.classList.remove('loading');
        signupBtn.disabled = false;
      }
    });

    // ============= NAVIGATION =============
    function goToLogin() {
      window.location.href = 'login.html';
    }

    // ============= PAGE LOAD =============
    document.addEventListener('DOMContentLoaded', () => {
      console.log("‚úÖ Signup page loaded");
      nameInput.focus();
    });

    // ============= ERROR HANDLING =============
    window.addEventListener('error', (event) => {
      console.error('‚ùå Global error:', event.error);
    });

    window.addEventListener('unhandledrejection', (event) => {
      console.error('‚ùå Unhandled rejection:', event.reason);
    });
  </script>
</body>
</html>
